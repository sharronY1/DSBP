<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DSBP - Digital Software Building Platform</title>
    <link rel="stylesheet" href="/static/src/assets/styles/styles.css" />
    
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="header-left">
        <div class="logo-container">
          <div class="logo-icon">D</div>
          <span class="logo-text">DSBP</span>
        </div>
        <div class="user-badge">
          <span class="user-icon" id="current-user-icon">?</span> 
          <span id="current-username" class="user-name">Loading...</span>
        </div>
      </div>
      <button id="logout-btn" class="btn-logout">Logout</button>
    </header>

    <div class="main-layout">
      <aside class="sidebar-left">
        <div class="sidebar-search">
          <input type="text" id="project-search" placeholder="Search..." />
        </div>
        <div class="projects-section">
          <div class="section-header">
            <span>Projects</span>
            <button id="btn-add-project" class="btn-add">+</button>
          </div>
          <ul id="projects-list" class="projects-list">
            </ul>
        </div>
      </aside>

      <main class="main-content">
        <div class="content-header">
          <nav class="tabs">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="taskboard">Task Board</button>
            <button class="tab" data-tab="dependency">Dependency Map</button>
            <button class="tab" data-tab="notifications">Notifications</button>
          </nav>
          <div class="header-actions">
            <button id="btn-add-task" class="btn-add-task">
              <span>+</span>
              <span>Add Task</span>
            </button>
          </div>
        </div>

        <div id="taskboard-view" class="taskboard-view">
          <div class="board-column" data-status="new_task">
            <div class="column-header">
              <h3>New task</h3>
              <span class="task-count" data-status="new_task">0</span>
            </div>
            <div class="tasks-container" data-status="new_task">
              </div>
          </div>
          <div class="board-column" data-status="scheduled">
            <div class="column-header">
              <h3>Scheduled</h3>
              <span class="task-count" data-status="scheduled">0</span>
            </div>
            <div class="tasks-container" data-status="scheduled">
              </div>
          </div>
          <div class="board-column" data-status="in_progress">
            <div class="column-header">
              <h3>In progress</h3>
              <span class="task-count" data-status="in_progress">0</span>
            </div>
            <div class="tasks-container" data-status="in_progress">
              </div>
          </div>
          <div class="board-column" data-status="completed">
            <div class="column-header">
              <h3>Completed</h3>
              <span class="task-count" data-status="completed">0</span>
            </div>
            <div class="tasks-container" data-status="completed">
              </div>
          </div>
        </div>

        <div id="dashboard-view" class="dashboard-view hidden">
          <div class="dashboard-grid">
            <section class="dashboard-card">
              <h2>Project Overview</h2>
              <p id="project-overview-name" class="dashboard-title">Select a project</p>
              <p id="project-overview-description" class="dashboard-description">
                Choose a project from the sidebar to view its details.
              </p>
              <div class="project-meta">
                <span id="project-overview-visibility">Visibility: --</span>
                <span id="project-overview-owner">Owner: --</span>
              </div>
            </section>
            <section class="dashboard-card">
              <div class="card-header">
                <h2>Project Visibility & Sharing</h2>
                <p id="project-settings-message" class="dashboard-note">
                  Select a project to edit its visibility.
                </p>
              </div>
              <form id="form-project-settings" class="settings-form">
                <div class="form-group">
                  <label for="project-settings-name">Project Name</label>
                  <input type="text" id="project-settings-name" />
                </div>
                <div class="form-group">
                  <label for="project-settings-description">Description</label>
                  <textarea id="project-settings-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label for="project-settings-visibility">Visibility</label>
                  <select id="project-settings-visibility">
                    <option value="private">Private</option>
                    <option value="selected">Selected users</option>
                    <option value="all">All users</option>
                  </select>
                </div>
                <div id="project-settings-users-wrapper" class="form-group hidden">
                  <label>Shared users</label>
                  <div id="project-settings-users" class="selected-users"></div>
                  <button type="button" id="btn-project-settings-users" class="btn-secondary">
                    Manage access
                  </button>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn-primary" id="btn-save-settings">Save changes</button>
                </div>
              </form>
            </section>
          </div>

          <div class="dashboard-grid analytics-grid">
            <section class="dashboard-card status-card">
              <div class="card-header">
                <h2>Task Status Overview</h2>
                <p id="status-summary-total" class="dashboard-note">Total tasks: 0</p>
              </div>
              <div class="status-chart-row">
                <canvas id="status-donut-chart" width="220" height="220"></canvas>
                <ul id="status-legend" class="status-legend"></ul>
              </div>
            </section>

            <section class="dashboard-card calendar-card">
              <div class="calendar-header">
                <button type="button" id="history-calendar-prev" aria-label="Previous month">‚Äπ</button>
                <div id="history-month-label">Month</div>
                <button type="button" id="history-calendar-next" aria-label="Next month">‚Ä∫</button>
              </div>
              <div class="calendar-weekdays">
                <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
              </div>
              <div id="history-calendar-grid" class="calendar-grid"></div>
            </section>
          </div>

          <section class="dashboard-card history-card">
            <div class="history-header">
              <div>
                <h2>Task History</h2>
                <p id="history-selected-date" class="dashboard-note">Select a date to see your activity.</p>
              </div>
            </div>
            <div id="history-list" class="history-list">
              <div class="empty-state">Select a date with history to view your task actions.</div>
            </div>
          </section>
        </div>

        <div id="dependency-view" class="dependency-view hidden">
          <div class="dependency-header">
            <div>
              <h2>Dependency Map</h2>
              <p class="dependency-subtitle">
                Link tasks across projects and visualize the merged chains.
              </p>
            </div>
            <p id="dependency-status-text" class="status-text"></p>
          </div>

          <div id="vis-graph-container"></div>
          <div id="dependency-legend" class="dependency-legend"></div>
          <div id="task-detail-popup" class="task-detail-popup hidden"></div>

          <form id="form-add-dependency" class="dependency-form">
            <select id="dependency-dependent" required>
              <option value="">Dependent task...</option>
            </select>
            <span class="dependency-arrow">depends on</span>
            <select id="dependency-depends-on" required>
              <option value="">Depends on...</option>
            </select>
            <button type="submit" class="btn-primary">Link tasks</button>
          </form>
          <div class="dependency-columns">
            <section>
              <h3>Linear chains</h3>
              <div id="dependency-chains" class="dependency-cards"></div>
            </section>
            <section>
              <h3>Converging dependencies</h3>
              <div id="dependency-convergences" class="dependency-cards"></div>
            </section>
          </div>
          <section class="dependency-edges-section">
            <h3>Edit dependencies</h3>
            <div id="dependency-edges" class="dependency-edges"></div>
          </section>
        </div>

        <div id="notifications-view" class="notifications-view hidden">
          <div class="notifications-header">
            <div>
              <h2>Notifications</h2>
              <p>Mentions from project comments appear here.</p>
            </div>
            <button id="btn-refresh-notifications" class="btn-secondary">Refresh</button>
          </div>
          <ul id="notifications-list" class="notifications-list"></ul>
        </div>
      </main>
    </div>

    <div id="modal-create-project" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create Project</h2>
          <button class="btn-close">&times;</button>
        </div>
        <form id="form-create-project" class="modal-body">
          <div class="form-group">
            <label for="project-name-form">Project Name</label>
            <input type="text" id="project-name-form" name="name" required />
          </div>
          <div class="form-group">
            <label for="project-description-form">Description</label>
            <textarea id="project-description-form" name="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="project-visibility">Visibility</label>
            <select id="project-visibility" name="visibility">
              <option value="private">Private</option>
              <option value="selected">Selected users</option>
              <option value="all">All users</option>
            </select>
          </div>
          <div id="project-users-wrapper" class="form-group hidden">
            <label>Add users</label>
            <button type="button" id="btn-select-project-users" class="btn-secondary">
              Select Users
            </button>
            <div id="selected-project-users" class="selected-users"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-secondary modal-cancel">Cancel</button>
            <button type="submit" class="btn-primary">Create</button>
          </div>
        </form>
      </div>
    </div>

    <div id="modal-user-selector" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Select User</h2>
          <button class="btn-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="search-box">
            <input type="text" id="user-search" placeholder="Search users..." />
          </div>
          <div class="user-list" id="user-list">
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="btn-user-selector-cancel">Cancel</button>
          <button type="button" class="btn-primary" id="btn-user-selector-apply">Apply</button>
        </div>
      </div>
    </div>

    <div id="task-detail-panel" class="side-panel hidden">
      <div class="side-panel-header">
        <input type="text" id="task-title-input" class="task-title-edit" placeholder="Task title" />
        <button id="btn-delete-task" class="btn-delete">
          <span>üóëÔ∏è</span>
          <span>Delete</span>
        </button>
      </div>
      <div class="side-panel-body">
        <div class="task-field">
          <div class="field-icon">üîµ</div>
          <label>Status</label>
          <select id="task-status-select" class="field-input">
            <option value="new_task">New task</option>
            <option value="scheduled">Scheduled</option>
            <option value="in_progress">In progress</option>
            <option value="completed">Completed</option>
          </select>
        </div>
        <div class="task-field">
          <div class="field-icon">üìÖ</div>
          <label>Due date</label>
          <input type="date" id="task-due-date" class="field-input" />
        </div>
        <div class="task-field">
          <div class="field-icon">üë•</div>
          <label>Assignees</label>
          <div class="field-value">
            <div id="task-assignees" class="assignees-list">
              </div>
            <button id="btn-add-assignee" class="btn-add-small">+ Add</button>
          </div>
        </div>
        <div class="task-comments">
          <div class="comments-header">
            <span class="icon-comment">üí¨</span>
            <h3>Comments</h3>
            <span id="comments-count" class="count-badge">0</span>
          </div>
          <div id="comments-list" class="comments-list">
            </div>
          <form id="form-add-comment" class="comment-form">
            <input type="text" placeholder="Add Comment" id="comment-input" />
            <button type="submit" class="btn-comment-submit">üí¨ Add Comment</button>
          </form>
        </div>
      </div>
      <button id="btn-close-panel" class="btn-close-panel">&times;</button>
    </div>

    <div id="modal-add-task" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Task</h2>
          <button class="btn-close">&times;</button>
        </div>
        <form id="form-add-task" class="modal-body">
          <div class="form-group">
            <label for="new-task-title">Title</label>
            <input type="text" id="new-task-title" name="title" required />
          </div>
          <div class="form-group">
            <label for="new-task-description">Description</label>
            <textarea id="new-task-description" name="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="new-task-status">Status</label>
            <select id="new-task-status" name="status">
              <option value="new_task">New task</option>
              <option value="scheduled">Scheduled</option>
              <option value="in_progress">In progress</option>
              <option value="completed">Completed</option>
            </select>
          </div>
          <div class="form-group">
            <label for="new-task-due-date">Due date</label>
            <input type="date" id="new-task-due-date" name="due_date" />
          </div>
          <div class="form-group">
            <label>Assignees</label>
            <button type="button" id="btn-select-task-assignees" class="btn-secondary">
              Select Assignees
            </button>
            <div id="selected-task-assignees" class="selected-users"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-secondary modal-cancel">Cancel</button>
            <button type="submit" class="btn-primary">Add Task</button>
          </div>
        </form>
      </div>
    </div>

    <script src="/static/src/components/app.js"></script>
    
  </body>
</html>
